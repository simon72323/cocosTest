System.register("bundle://internal/_virtual/builtin-pipeline-settings.ts",["./rollupPluginModLoBabelHelpers.js","cc","./builtin-pipeline-types.ts"],(function(t){var e,o,i,n,r,s,a,p,l,g,c,y,d,u,h,f,b,m,P;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.inherits,i=t.createSuper,n=t.createClass,r=t.classCallCheck,s=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){p=t.cclegacy,l=t._decorator,g=t.Camera,c=t.CCBoolean,y=t.CCInteger,d=t.CCFloat,u=t.Material,h=t.Texture2D,f=t.rendering,b=t.Component},function(t){m=t.makePipelineSettings,P=t.fillRequiredPipelineSettings}],execute:function(){var _,O,M,D,S,k,F,w,E,G,v,C,j,A,R,x,B,I,T,L,X,z,H,q,Y,N,Q,Z,J,K,U,V,W,$;p._RF.push({},"de1c2EHcMhAIYRZY5nyTQHG","builtin-pipeline-settings",void 0);var tt=l.ccclass,et=l.disallowMultiple,ot=l.executeInEditMode,it=l.menu,nt=l.property,rt=l.requireComponent,st=l.type;t("BuiltinPipelineSettings",(_=tt("BuiltinPipelineSettings"),O=it("Rendering/BuiltinPipelineSettings"),M=rt(g),D=nt(c),S=nt({displayName:"Editor Preview (Experimental)",type:c}),k=nt({group:{id:"MSAA",name:"Multisample Anti-Aliasing"},type:c}),F=nt({group:{id:"MSAA",name:"Multisample Anti-Aliasing",style:"section"},type:y,range:[2,4,2]}),w=nt({group:{id:"ShadingScale",name:"ShadingScale",style:"section"},type:c}),E=nt({tooltip:"i18n:postprocess.shadingScale",group:{id:"ShadingScale",name:"ShadingScale"},type:d,range:[.01,4,.01],slide:!0}),G=nt({group:{id:"DepthOfField",name:"DepthOfField (PostProcessing)",style:"section"},type:c,visible:!1}),v=nt({group:{id:"DepthOfField",name:"DepthOfField (PostProcessing)",style:"section"},type:u,visible:!1}),C=nt({group:{id:"DepthOfField",name:"DepthOfField (PostProcessing)",style:"section"},type:d,min:0,visible:!1}),j=nt({group:{id:"DepthOfField",name:"DepthOfField (PostProcessing)",style:"section"},type:d,min:0,visible:!1}),A=st(d),R=nt({group:{id:"DepthOfField",name:"DepthOfField (PostProcessing)",style:"section"},type:d,range:[1,10,.01],slide:!0,visible:!1}),x=nt({group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:c}),B=nt({group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:u}),I=nt({tooltip:"i18n:bloom.enableAlphaMask",group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:c}),T=nt({tooltip:"i18n:bloom.iterations",group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:y,range:[1,6,1],slide:!0}),L=nt({tooltip:"i18n:bloom.threshold",group:{id:"Bloom",name:"Bloom (PostProcessing)",style:"section"},type:d,min:0}),X=nt({group:{id:"Color Grading",name:"ColorGrading (LDR) (PostProcessing)",style:"section"},type:c}),z=nt({group:{id:"Color Grading",name:"ColorGrading (LDR) (PostProcessing)",style:"section"},type:u}),H=nt({tooltip:"i18n:color_grading.contribute",group:{id:"Color Grading",name:"ColorGrading (LDR) (PostProcessing)",style:"section"},type:d,range:[0,1,.01],slide:!0}),q=nt({tooltip:"i18n:color_grading.originalMap",group:{id:"Color Grading",name:"ColorGrading (LDR) (PostProcessing)",style:"section"},type:h}),Y=nt({group:{id:"FXAA",name:"Fast Approximate Anti-Aliasing (PostProcessing)",style:"section"},type:c}),N=nt({group:{id:"FXAA",name:"Fast Approximate Anti-Aliasing (PostProcessing)",style:"section"},type:u}),Q=nt({group:{id:"FSR",name:"FidelityFX Super Resolution",style:"section"},type:c}),Z=nt({group:{id:"FSR",name:"FidelityFX Super Resolution",style:"section"},type:u}),J=nt({group:{id:"FSR",name:"FidelityFX Super Resolution",style:"section"},type:d,range:[0,1,.01],slide:!0}),K=nt({group:{id:"ToneMapping",name:"ToneMapping",style:"section"},type:u}),_(U=O(U=M(U=et(U=ot((W=e((V=function(t){o(p,t);var e=i(p);function p(){var t;r(this,p);for(var o=arguments.length,i=new Array(o),n=0;n<o;n++)i[n]=arguments[n];return t=e.call.apply(e,[this].concat(i)),s(a(t),"_settings",W,a(t)),s(a(t),"_editorPreview",$,a(t)),t}return n(p,[{key:"onEnable",value:function(){P(this._settings),this.getComponent(g).camera.pipelineSettings=this._settings}},{key:"onDisable",value:function(){this.getComponent(g).camera.pipelineSettings=null}},{key:"editorPreview",get:function(){return this._editorPreview},set:function(t){this._editorPreview=t}},{key:"_tryEnableEditorPreview",value:function(){void 0!==f&&(this._editorPreview?f.setEditorPipelineSettings(this._settings):this._disableEditorPreview())}},{key:"_disableEditorPreview",value:function(){void 0!==f&&(f.getEditorPipelineSettings()===this._settings&&f.setEditorPipelineSettings(null))}},{key:"MsaaEnable",get:function(){return this._settings.msaa.enabled},set:function(t){this._settings.msaa.enabled=t}},{key:"msaaSampleCount",get:function(){return this._settings.msaa.sampleCount},set:function(t){t=Math.pow(2,Math.ceil(Math.log2(Math.max(t,2)))),t=Math.min(t,4),this._settings.msaa.sampleCount=t}},{key:"shadingScaleEnable",get:function(){return this._settings.enableShadingScale},set:function(t){this._settings.enableShadingScale=t}},{key:"shadingScale",get:function(){return this._settings.shadingScale},set:function(t){this._settings.shadingScale=t}},{key:"dofEnable",get:function(){return this._settings.depthOfField.enabled},set:function(t){this._settings.depthOfField.enabled=t}},{key:"dofMaterial",get:function(){return this._settings.depthOfField.material},set:function(t){this._settings.depthOfField.material!==t&&(this._settings.depthOfField.material=t)}},{key:"dofFocusDistance",get:function(){return this._settings.depthOfField.focusDistance},set:function(t){this._settings.depthOfField.focusDistance=t}},{key:"dofFocusRange",get:function(){return this._settings.depthOfField.focusRange},set:function(t){this._settings.depthOfField.focusRange=t}},{key:"dofBokehRadius",get:function(){return this._settings.depthOfField.bokehRadius},set:function(t){this._settings.depthOfField.bokehRadius=t}},{key:"bloomEnable",get:function(){return this._settings.bloom.enabled},set:function(t){this._settings.bloom.enabled=t}},{key:"bloomMaterial",get:function(){return this._settings.bloom.material},set:function(t){this._settings.bloom.material!==t&&(this._settings.bloom.material=t)}},{key:"bloomEnableAlphaMask",get:function(){return this._settings.bloom.enableAlphaMask},set:function(t){this._settings.bloom.enableAlphaMask=t}},{key:"bloomIterations",get:function(){return this._settings.bloom.iterations},set:function(t){this._settings.bloom.iterations=t}},{key:"bloomThreshold",get:function(){return this._settings.bloom.threshold},set:function(t){this._settings.bloom.threshold=t}},{key:"bloomIntensity",get:function(){return this._settings.bloom.intensity},set:function(t){this._settings.bloom.intensity=t}},{key:"colorGradingEnable",get:function(){return this._settings.colorGrading.enabled},set:function(t){this._settings.colorGrading.enabled=t}},{key:"colorGradingMaterial",get:function(){return this._settings.colorGrading.material},set:function(t){this._settings.colorGrading.material!==t&&(this._settings.colorGrading.material=t)}},{key:"colorGradingContribute",get:function(){return this._settings.colorGrading.contribute},set:function(t){this._settings.colorGrading.contribute=t}},{key:"colorGradingMap",get:function(){return this._settings.colorGrading.colorGradingMap},set:function(t){this._settings.colorGrading.colorGradingMap=t}},{key:"fxaaEnable",get:function(){return this._settings.fxaa.enabled},set:function(t){this._settings.fxaa.enabled=t}},{key:"fxaaMaterial",get:function(){return this._settings.fxaa.material},set:function(t){this._settings.fxaa.material!==t&&(this._settings.fxaa.material=t)}},{key:"fsrEnable",get:function(){return this._settings.fsr.enabled},set:function(t){this._settings.fsr.enabled=t}},{key:"fsrMaterial",get:function(){return this._settings.fsr.material},set:function(t){this._settings.fsr.material!==t&&(this._settings.fsr.material=t)}},{key:"fsrSharpness",get:function(){return this._settings.fsr.sharpness},set:function(t){this._settings.fsr.sharpness=t}},{key:"toneMappingMaterial",get:function(){return this._settings.toneMapping.material},set:function(t){this._settings.toneMapping.material!==t&&(this._settings.toneMapping.material=t)}}]),p}(b)).prototype,"_settings",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return m()}}),$=e(V.prototype,"_editorPreview",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),e(V.prototype,"editorPreview",[S],Object.getOwnPropertyDescriptor(V.prototype,"editorPreview"),V.prototype),e(V.prototype,"MsaaEnable",[k],Object.getOwnPropertyDescriptor(V.prototype,"MsaaEnable"),V.prototype),e(V.prototype,"msaaSampleCount",[F],Object.getOwnPropertyDescriptor(V.prototype,"msaaSampleCount"),V.prototype),e(V.prototype,"shadingScaleEnable",[w],Object.getOwnPropertyDescriptor(V.prototype,"shadingScaleEnable"),V.prototype),e(V.prototype,"shadingScale",[E],Object.getOwnPropertyDescriptor(V.prototype,"shadingScale"),V.prototype),e(V.prototype,"dofEnable",[G],Object.getOwnPropertyDescriptor(V.prototype,"dofEnable"),V.prototype),e(V.prototype,"dofMaterial",[v],Object.getOwnPropertyDescriptor(V.prototype,"dofMaterial"),V.prototype),e(V.prototype,"dofFocusDistance",[C],Object.getOwnPropertyDescriptor(V.prototype,"dofFocusDistance"),V.prototype),e(V.prototype,"dofFocusRange",[j],Object.getOwnPropertyDescriptor(V.prototype,"dofFocusRange"),V.prototype),e(V.prototype,"dofBokehRadius",[A,R],Object.getOwnPropertyDescriptor(V.prototype,"dofBokehRadius"),V.prototype),e(V.prototype,"bloomEnable",[x],Object.getOwnPropertyDescriptor(V.prototype,"bloomEnable"),V.prototype),e(V.prototype,"bloomMaterial",[B],Object.getOwnPropertyDescriptor(V.prototype,"bloomMaterial"),V.prototype),e(V.prototype,"bloomEnableAlphaMask",[I],Object.getOwnPropertyDescriptor(V.prototype,"bloomEnableAlphaMask"),V.prototype),e(V.prototype,"bloomIterations",[T],Object.getOwnPropertyDescriptor(V.prototype,"bloomIterations"),V.prototype),e(V.prototype,"bloomThreshold",[L],Object.getOwnPropertyDescriptor(V.prototype,"bloomThreshold"),V.prototype),e(V.prototype,"colorGradingEnable",[X],Object.getOwnPropertyDescriptor(V.prototype,"colorGradingEnable"),V.prototype),e(V.prototype,"colorGradingMaterial",[z],Object.getOwnPropertyDescriptor(V.prototype,"colorGradingMaterial"),V.prototype),e(V.prototype,"colorGradingContribute",[H],Object.getOwnPropertyDescriptor(V.prototype,"colorGradingContribute"),V.prototype),e(V.prototype,"colorGradingMap",[q],Object.getOwnPropertyDescriptor(V.prototype,"colorGradingMap"),V.prototype),e(V.prototype,"fxaaEnable",[Y],Object.getOwnPropertyDescriptor(V.prototype,"fxaaEnable"),V.prototype),e(V.prototype,"fxaaMaterial",[N],Object.getOwnPropertyDescriptor(V.prototype,"fxaaMaterial"),V.prototype),e(V.prototype,"fsrEnable",[Q],Object.getOwnPropertyDescriptor(V.prototype,"fsrEnable"),V.prototype),e(V.prototype,"fsrMaterial",[Z],Object.getOwnPropertyDescriptor(V.prototype,"fsrMaterial"),V.prototype),e(V.prototype,"fsrSharpness",[J],Object.getOwnPropertyDescriptor(V.prototype,"fsrSharpness"),V.prototype),e(V.prototype,"toneMappingMaterial",[K],Object.getOwnPropertyDescriptor(V.prototype,"toneMappingMaterial"),V.prototype),U=V))||U)||U)||U)||U)||U));p._RF.pop()}}}));

System.register("bundle://internal/_virtual/builtin-pipeline-types.ts",["cc"],(function(e){var a,n;return{setters:[function(e){a=e.cclegacy,n=e.gfx}],execute:function(){e({fillRequiredBloom:u,fillRequiredColorGrading:c,fillRequiredDepthOfField:r,fillRequiredFSR:f,fillRequiredFXAA:p,fillRequiredHBAO:function(e){void 0===e.enabled&&(e.enabled=!1);void 0===e.radiusScale&&(e.radiusScale=1);void 0===e.angleBiasDegree&&(e.angleBiasDegree=10);void 0===e.blurSharpness&&(e.blurSharpness=3);void 0===e.aoSaturation&&(e.aoSaturation=1);void 0===e.needBlur&&(e.needBlur=!1)},fillRequiredMSAA:t,fillRequiredPipelineSettings:function(e){e.msaa?t(e.msaa):e.msaa=i();void 0===e.enableShadingScale&&(e.enableShadingScale=!1);void 0===e.shadingScale&&(e.shadingScale=.5);e.depthOfField?r(e.depthOfField):e.depthOfField={enabled:!1,material:null,focusDistance:0,focusRange:0,bokehRadius:1};e.bloom?u(e.bloom):e.bloom={enabled:!1,material:null,enableAlphaMask:!1,iterations:3,threshold:.8,intensity:2.3};e.toneMapping?g(e.toneMapping):e.toneMapping={material:null};e.colorGrading?c(e.colorGrading):e.colorGrading={enabled:!1,material:null,contribute:1,colorGradingMap:null};e.fsr?f(e.fsr):e.fsr={enabled:!1,material:null,sharpness:.8};e.fxaa?p(e.fxaa):e.fxaa={enabled:!1,material:null}},fillRequiredToneMapping:g,makeBloom:d,makeColorGrading:s,makeDepthOfField:o,makeFSR:b,makeFXAA:m,makeHBAO:function(){return{enabled:!1,radiusScale:1,angleBiasDegree:10,blurSharpness:3,aoSaturation:1,needBlur:!1}},makeMSAA:i,makePipelineSettings:function(){return{msaa:i(),enableShadingScale:!1,shadingScale:.5,depthOfField:{enabled:!1,material:null,focusDistance:0,focusRange:0,bokehRadius:1},bloom:{enabled:!1,material:null,enableAlphaMask:!1,iterations:3,threshold:.8,intensity:2.3},toneMapping:{material:null},colorGrading:{enabled:!1,material:null,contribute:1,colorGradingMap:null},fsr:{enabled:!1,material:null,sharpness:.8},fxaa:{enabled:!1,material:null}}},makeToneMapping:h}),a._RF.push({},"cbf30kCUX9A3K+QpVC6wnzx","builtin-pipeline-types",void 0);var l=n.SampleCount;function i(){return{enabled:!1,sampleCount:l.X4}}function t(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.sampleCount&&(e.sampleCount=l.X4)}function o(){return{enabled:!1,material:null,focusDistance:0,focusRange:0,bokehRadius:1}}function r(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.material&&(e.material=null),void 0===e.focusDistance&&(e.focusDistance=0),void 0===e.focusRange&&(e.focusRange=0),void 0===e.bokehRadius&&(e.bokehRadius=1)}function d(){return{enabled:!1,material:null,enableAlphaMask:!1,iterations:3,threshold:.8,intensity:2.3}}function u(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.material&&(e.material=null),void 0===e.enableAlphaMask&&(e.enableAlphaMask=!1),void 0===e.iterations&&(e.iterations=3),void 0===e.threshold&&(e.threshold=.8),void 0===e.intensity&&(e.intensity=2.3)}function s(){return{enabled:!1,material:null,contribute:1,colorGradingMap:null}}function c(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.material&&(e.material=null),void 0===e.contribute&&(e.contribute=1),void 0===e.colorGradingMap&&(e.colorGradingMap=null)}function b(){return{enabled:!1,material:null,sharpness:.8}}function f(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.material&&(e.material=null),void 0===e.sharpness&&(e.sharpness=.8)}function m(){return{enabled:!1,material:null}}function p(e){void 0===e.enabled&&(e.enabled=!1),void 0===e.material&&(e.material=null)}function h(){return{material:null}}function g(e){void 0===e.material&&(e.material=null)}a._RF.pop()}}}));

System.register("bundle://internal/_virtual/builtin-pipeline.ts",["./rollupPluginModLoBabelHelpers.js","cc","./env","./builtin-pipeline-types.ts"],(function(){var e,a,t,i,s,o,r,n,d,l,h,c,p,g,u,m,f,_,S,T,R;return{setters:[function(s){e=s.createClass,a=s.classCallCheck,t=s.defineProperty,i=s.createForOfIteratorHelper},function(e){s=e.cclegacy,o=e.geometry,r=e.gfx,n=e.renderer,d=e.rendering,l=e.Vec3,h=e.Vec4,c=e.Vec2,p=e.Material,g=e.PipelineEventType,u=e.assert,m=e.clamp,f=e.sys,_=e.pipeline,S=e.Layers},function(e){e.EDITOR,T=e.DEBUG},function(e){R=e.makePipelineSettings}],execute:function(){s._RF.push({},"ff9b0GZzgRM/obMbHGfCNbk","builtin-pipeline",void 0);var b=o.AABB,P=o.Sphere,C=o.intersect,w=r.ClearFlagBit,E=r.Color,M=r.Format,x=r.FormatFeatureBit,v=r.LoadOp,A=r.StoreOp,L=r.TextureType,D=r.Viewport,F=n.scene,O=F.CameraUsage,y=F.CSMLevel,N=F.LightType;function Q(e){return!!(e.clearFlag&(w.COLOR|w.STENCIL<<1))}function z(e,a,t,i,s,o){e.shadowFixedArea||e.csmLevel===y.LEVEL_1?(s.left=0,s.top=0,s.width=Math.trunc(a),s.height=Math.trunc(t)):(s.left=Math.trunc(i%2*.5*a),s.top=o>0?Math.trunc(.5*(1-Math.floor(i/2))*t):Math.trunc(.5*Math.floor(i/2)*t),s.width=Math.trunc(.5*a),s.height=Math.trunc(.5*t)),s.left=Math.max(0,s.left),s.top=Math.max(0,s.top),s.width=Math.max(1,s.width),s.height=Math.max(1,s.height)}var B=e((function e(){a(this,e),t(this,"isWeb",!1),t(this,"isWebGL1",!1),t(this,"isWebGPU",!1),t(this,"isMobile",!1),t(this,"isHDR",!1),t(this,"useFloatOutput",!1),t(this,"toneMappingType",0),t(this,"shadowEnabled",!1),t(this,"shadowMapFormat",M.R32F),t(this,"shadowMapSize",new c(1,1)),t(this,"usePlanarShadow",!1),t(this,"screenSpaceSignY",1),t(this,"supportDepthSample",!1),t(this,"mobileMaxSpotLightShadowMaps",1),t(this,"platform",new h(0,0,0,0))}));function k(e,a){var t=x.SAMPLED_TEXTURE|x.LINEAR_FILTER,i=e.device;a.isWeb=!f.isNative,a.isWebGL1=i.gfxAPI===r.API.WEBGL,a.isWebGPU=i.gfxAPI===r.API.WEBGPU,a.isMobile=f.isMobile,a.isHDR=e.pipelineSceneData.isHDR,a.useFloatOutput=e.getMacroBool("CC_USE_FLOAT_OUTPUT"),a.toneMappingType=e.pipelineSceneData.postSettings.toneMappingType;var s=e.pipelineSceneData.shadows;a.shadowEnabled=s.enabled,a.shadowMapFormat=_.supportsR32FloatTexture(e.device)?M.R32F:M.RGBA8,a.shadowMapSize.set(s.size),a.usePlanarShadow=s.enabled&&s.type===n.scene.ShadowType.Planar,a.screenSpaceSignY=e.device.capabilities.screenSpaceSignY,a.supportDepthSample=(e.device.getFormatFeatures(M.DEPTH_STENCIL)&t)===t;var o=i.capabilities.screenSpaceSignY;a.platform.x=a.isMobile?1:0,a.platform.w=.5*o+.5<<1|.5*i.capabilities.clipSpaceSignY+.5}var G=R(),I=e((function e(){a(this,e),t(this,"colorName",""),t(this,"depthStencilName",""),t(this,"enableMainLightShadowMap",!1),t(this,"enableMainLightPlanarShadowMap",!1),t(this,"enablePostProcess",!1),t(this,"enableProfiler",!1),t(this,"enableShadingScale",!1),t(this,"enableMSAA",!1),t(this,"enableDOF",!1),t(this,"enableBloom",!1),t(this,"enableColorGrading",!1),t(this,"enableFXAA",!1),t(this,"enableFSR",!1),t(this,"enableHDR",!1),t(this,"enablePlanarReflectionProbe",!1),t(this,"useFullPipeline",!1),t(this,"singleForwardRadiancePass",!1),t(this,"radianceFormat",r.Format.RGBA8),t(this,"shadingScale",.5),t(this,"settings",G)}));function H(e,a,t){t.enableDOF=e.supportDepthSample&&a.depthOfField.enabled&&!!a.depthOfField.material,t.enableBloom=a.bloom.enabled&&!!a.bloom.material,t.enableColorGrading=a.colorGrading.enabled&&!!a.colorGrading.material&&!!a.colorGrading.colorGradingMap,t.enableFXAA=a.fxaa.enabled&&!!a.fxaa.material,t.enablePostProcess=t.enableDOF||t.enableBloom||t.enableColorGrading||t.enableFXAA}function V(e,a,t){var i=e.window,s=e.cameraUsage===O.GAME&&!!i.swapchain,o=e.cameraUsage===O.SCENE_VIEW||e.cameraUsage===O.PREVIEW;if(t.colorName=i.colorName,t.depthStencilName=i.depthStencilName,t.useFullPipeline=0!=(e.visibility&S.Enum.DEFAULT),t.enableMainLightShadowMap=a.shadowEnabled&&!a.usePlanarShadow&&!!e.scene&&!!e.scene.mainLight&&e.scene.mainLight.shadowEnabled,t.enableMainLightPlanarShadowMap=a.shadowEnabled&&a.usePlanarShadow&&!!e.scene&&!!e.scene.mainLight&&e.scene.mainLight.shadowEnabled,t.enablePlanarReflectionProbe=s||e.cameraUsage===O.SCENE_VIEW,t.enableProfiler=T,t.settings=e.pipelineSettings?e.pipelineSettings:G,H(a,t.settings,t),o){var n=d.getEditorPipelineSettings();n&&(t.settings=n,H(a,t.settings,t))}t.enableMSAA=t.settings.msaa.enabled&&!a.isWeb&&!a.isWebGL1,t.shadingScale=t.settings.shadingScale,t.enableShadingScale=t.settings.enableShadingScale&&1!==t.shadingScale,t.enableFSR=t.settings.fsr.enabled&&!!t.settings.fsr.material&&t.enableShadingScale&&t.shadingScale<1,t.singleForwardRadiancePass=a.isMobile||t.enableMSAA,t.enableHDR=t.useFullPipeline&&a.useFloatOutput,t.radianceFormat=t.enableHDR?r.Format.RGBA16F:r.Format.RGBA8}if(d){var U=d.QueueHint,W=d.SceneFlags,Y=d.ResourceFlags,X=d.ResourceResidency,K=function(){function s(){a(this,s),t(this,"lights",[]),t(this,"shadowEnabledSpotLights",[]),t(this,"_sphere",P.create(0,0,0,1)),t(this,"_boundingBox",new b),t(this,"_rangedDirLightBoundingBox",new b(0,0,0,.5,.5,.5))}return e(s,[{key:"cullLights",value:function(e,a,t){this.lights.length=0,this.shadowEnabledSpotLights.length=0;var s,o=i(e.spotLights);try{for(o.s();!(s=o.n()).done;){var r=s.value;r.baked||(P.set(this._sphere,r.position.x,r.position.y,r.position.z,r.range),C.sphereFrustum(this._sphere,a)&&(r.shadowEnabled?this.shadowEnabledSpotLights.push(r):this.lights.push(r)))}}catch(e){o.e(e)}finally{o.f()}var n,d=i(e.sphereLights);try{for(d.s();!(n=d.n()).done;){var h=n.value;h.baked||(P.set(this._sphere,h.position.x,h.position.y,h.position.z,h.range),C.sphereFrustum(this._sphere,a)&&this.lights.push(h))}}catch(e){d.e(e)}finally{d.f()}var c,p=i(e.pointLights);try{for(p.s();!(c=p.n()).done;){var g=c.value;g.baked||(P.set(this._sphere,g.position.x,g.position.y,g.position.z,g.range),C.sphereFrustum(this._sphere,a)&&this.lights.push(g))}}catch(e){p.e(e)}finally{p.f()}var u,m=i(e.rangedDirLights);try{for(m.s();!(u=m.n()).done;){var f=u.value;b.transform(this._boundingBox,this._rangedDirLightBoundingBox,f.node.getWorldMatrix()),C.aabbFrustum(this._boundingBox,a)&&this.lights.push(f)}}catch(e){m.e(e)}finally{m.f()}t&&this.shadowEnabledSpotLights.sort((function(e,a){return l.squaredDistance(t,e.position)-l.squaredDistance(t,a.position)}))}},{key:"_addLightQueues",value:function(e,a){var t,s=i(this.lights);try{for(s.s();!(t=s.n()).done;){var o=t.value,r=a.addQueue(U.BLEND,"forward-add");switch(o.type){case N.SPHERE:r.name="sphere-light";break;case N.SPOT:r.name="spot-light";break;case N.POINT:r.name="point-light";break;case N.RANGED_DIRECTIONAL:r.name="ranged-directional-light";break;default:r.name="unknown-light"}r.addScene(e,W.BLEND,o)}}catch(e){s.e(e)}finally{s.f()}}},{key:"addSpotlightShadowPasses",value:function(e,a,t){var s,o=0,r=i(this.shadowEnabledSpotLights);try{for(r.s();!(s=r.n()).done;){var n=s.value,d=e.pipelineSceneData.shadows.size,l=e.addRenderPass(d.x,d.y,"default");if(l.name="SpotLightShadowPass".concat(o),l.addRenderTarget("SpotShadowMap".concat(o),v.CLEAR,A.STORE,new E(1,1,1,1)),l.addDepthStencil("SpotShadowDepth".concat(o),v.CLEAR,A.DISCARD),l.addQueue(U.NONE,"shadow-caster").addScene(a,W.OPAQUE|W.MASK|W.SHADOW_CASTER).useLightFrustum(n),++o>=t)break}}catch(e){r.e(e)}finally{r.f()}}},{key:"addLightQueues",value:function(e,a,t){this._addLightQueues(a,e);var s,o=0,r=i(this.shadowEnabledSpotLights);try{for(r.s();!(s=r.n()).done;){var n=s.value;if(e.addTexture("SpotShadowMap".concat(o),"cc_spotShadowMap"),e.addQueue(U.BLEND,"forward-add").addScene(a,W.BLEND,n),++o>=t)break}}catch(e){r.e(e)}finally{r.f()}}},{key:"addLightPasses",value:function(e,a,t,s,o,r,n,d,l,h){this._addLightQueues(n,h);var c,p=0,g=l.pipelineSceneData.shadows.size,u=i(this.shadowEnabledSpotLights);try{for(u.s();!(c=u.n()).done;){var m=c.value,f=l.addRenderPass(g.x,g.y,"default");f.name="SpotlightShadowPass",f.addRenderTarget("ShadowMap".concat(s),v.CLEAR,A.STORE,new E(1,1,1,1)),f.addDepthStencil("ShadowDepth".concat(s),v.CLEAR,A.DISCARD),f.addQueue(U.NONE,"shadow-caster").addScene(n,W.OPAQUE|W.MASK|W.SHADOW_CASTER).useLightFrustum(m);var _=++p===this.shadowEnabledSpotLights.length?t:A.STORE;(h=l.addRenderPass(o,r,"default")).name="SpotlightWithShadowMap",h.setViewport(d),h.addRenderTarget(e,v.LOAD),h.addDepthStencil(a,v.LOAD,_),h.addTexture("ShadowMap".concat(s),"cc_spotShadowMap"),h.addQueue(U.BLEND,"forward-add").addScene(n,W.BLEND,m)}}catch(e){u.e(e)}finally{u.f()}return h}},{key:"isMultipleLightPassesNeeded",value:function(){return this.shadowEnabledSpotLights.length>0}}]),s}(),j=function(){function o(){a(this,o),t(this,"_pipelineEvent",s.director.root.pipelineEvent),t(this,"_clearColor",new E(0,0,0,1)),t(this,"_clearColorTransparentBlack",new E(0,0,0,0)),t(this,"_reflectionProbeClearColor",new l(0,0,0)),t(this,"_viewport",new D),t(this,"_configs",new B),t(this,"_cameraConfigs",new I),t(this,"_cocParams",new h(0,0,0,0)),t(this,"_cocTexSize",new h(0,0,0,0)),t(this,"_bloomParams",new h(0,0,0,0)),t(this,"_bloomTexSize",new h(0,0,0,0)),t(this,"_bloomWidths",[]),t(this,"_bloomHeights",[]),t(this,"_bloomTexNames",[]),t(this,"_colorGradingTexSize",new c(0,0)),t(this,"_fxaaParams",new h(0,0,0,0)),t(this,"_fsrParams",new h(0,0,0,0)),t(this,"_fsrTexSize",new h(0,0,0,0)),t(this,"_copyAndTonemapMaterial",new p),t(this,"_initialized",!1),t(this,"forwardLighting",new K)}return e(o,[{key:"windowResize",value:function(e,a,t,i,s){k(e,this._configs),V(t,this._configs,this._cameraConfigs);var o=this._cameraConfigs.settings,r=a.renderWindowId,n=this._cameraConfigs.enableShadingScale?Math.max(Math.floor(i*this._cameraConfigs.shadingScale),1):i,d=this._cameraConfigs.enableShadingScale?Math.max(Math.floor(s*this._cameraConfigs.shadingScale),1):s;if(e.addRenderWindow(this._cameraConfigs.colorName,M.RGBA8,i,s,a,this._cameraConfigs.depthStencilName),this._cameraConfigs.enableShadingScale?(e.addDepthStencil("ScaledSceneDepth".concat(r),M.DEPTH_STENCIL,n,d),e.addRenderTarget("ScaledRadiance".concat(r),this._cameraConfigs.radianceFormat,n,d),e.addRenderTarget("ScaledLdrColor".concat(r),M.RGBA8,n,d)):(e.addDepthStencil("SceneDepth".concat(r),M.DEPTH_STENCIL,n,d),e.addRenderTarget("Radiance".concat(r),this._cameraConfigs.radianceFormat,n,d),e.addRenderTarget("LdrColor".concat(r),M.RGBA8,n,d)),this._cameraConfigs.enableFSR&&e.addRenderTarget("FsrColor".concat(r),M.RGBA8,i,s),this._cameraConfigs.enableMSAA&&(this._cameraConfigs.enableHDR?e.addTexture("MsaaRadiance".concat(r),L.TEX2D,this._cameraConfigs.radianceFormat,n,d,1,1,1,o.msaa.sampleCount,Y.COLOR_ATTACHMENT,X.MEMORYLESS):e.addTexture("MsaaRadiance".concat(r),L.TEX2D,M.RGBA8,n,d,1,1,1,o.msaa.sampleCount,Y.COLOR_ATTACHMENT,X.MEMORYLESS),e.addTexture("MsaaDepthStencil".concat(r),L.TEX2D,M.DEPTH_STENCIL,n,d,1,1,1,o.msaa.sampleCount,Y.DEPTH_STENCIL_ATTACHMENT,X.MEMORYLESS)),e.addRenderTarget("ShadowMap".concat(r),this._configs.shadowMapFormat,this._configs.shadowMapSize.x,this._configs.shadowMapSize.y),e.addDepthStencil("ShadowDepth".concat(r),M.DEPTH_STENCIL,this._configs.shadowMapSize.x,this._configs.shadowMapSize.y),this._cameraConfigs.singleForwardRadiancePass)for(var l=this._configs.mobileMaxSpotLightShadowMaps,h=0;h!==l;++h)e.addRenderTarget("SpotShadowMap".concat(h),this._configs.shadowMapFormat,this._configs.shadowMapSize.x,this._configs.shadowMapSize.y),e.addDepthStencil("SpotShadowDepth".concat(h),M.DEPTH_STENCIL,this._configs.shadowMapSize.x,this._configs.shadowMapSize.y);if(this._cameraConfigs.enableDOF){var c=Math.max(Math.floor(n/2),1),p=Math.max(Math.floor(d/2),1);e.addRenderTarget("DofRadiance".concat(r),this._cameraConfigs.radianceFormat,n,d),e.addRenderTarget("DofPrefilter".concat(r),this._cameraConfigs.radianceFormat,c,p),e.addRenderTarget("DofBokeh".concat(r),this._cameraConfigs.radianceFormat,c,p),e.addRenderTarget("DofFilter".concat(r),this._cameraConfigs.radianceFormat,c,p)}if(this._cameraConfigs.enableBloom)for(var g=n,u=d,m=0;m!==o.bloom.iterations+1;++m)g=Math.max(Math.floor(g/2),1),u=Math.max(Math.floor(u/2),1),e.addRenderTarget("BloomTex".concat(r,"_").concat(m),this._cameraConfigs.radianceFormat,g,u);this._cameraConfigs.enableColorGrading&&o.colorGrading.material&&o.colorGrading.colorGradingMap&&o.colorGrading.material.setProperty("colorGradingMap",o.colorGrading.colorGradingMap),this._cameraConfigs.enableFXAA&&this._cameraConfigs.enableShadingScale&&e.addRenderTarget("AaColor".concat(r),M.RGBA8,n,d)}},{key:"setup",value:function(e,a){if(!this._initMaterials(a)){var t,s=i(e);try{for(s.s();!(t=s.n()).done;){var o=t.value;o.scene&&o.window&&(V(o,this._configs,this._cameraConfigs),this._pipelineEvent.emit(g.RENDER_CAMERA_BEGIN,o),this._cameraConfigs.useFullPipeline?this._buildForwardPipeline(a,o,o.scene):this._buildSimplePipeline(a,o),this._pipelineEvent.emit(g.RENDER_CAMERA_END,o))}}catch(e){s.e(e)}finally{s.f()}}}},{key:"_buildSimplePipeline",value:function(e,a){var t=Math.max(Math.floor(a.window.width),1),i=Math.max(Math.floor(a.window.height),1),s=this._cameraConfigs.colorName,o=this._cameraConfigs.depthStencilName,r=a.viewport;this._viewport.left=Math.round(r.x*t),this._viewport.top=Math.round(r.y*i),this._viewport.width=Math.max(Math.round(r.width*t),1),this._viewport.height=Math.max(Math.round(r.height*i),1);var n=a.clearColor;this._clearColor.x=n.x,this._clearColor.y=n.y,this._clearColor.z=n.z,this._clearColor.w=n.w;var d=e.addRenderPass(t,i,"default");Q(a)?d.addRenderTarget(s,v.CLEAR,A.STORE,this._clearColor):d.addRenderTarget(s,v.LOAD,A.STORE),a.clearFlag&w.DEPTH_STENCIL?d.addDepthStencil(o,v.CLEAR,A.DISCARD,a.clearDepth,a.clearStencil,a.clearFlag&w.DEPTH_STENCIL):d.addDepthStencil(o,v.LOAD,A.DISCARD),d.setViewport(this._viewport),d.addQueue(U.OPAQUE).addScene(a,W.OPAQUE);var l=W.BLEND|W.UI;this._cameraConfigs.enableProfiler&&(l|=W.PROFILER,d.showStatistics=!0),d.addQueue(U.BLEND).addScene(a,l)}},{key:"_buildForwardPipeline",value:function(e,a,t){var i,s=this._cameraConfigs.settings,o=Math.max(Math.floor(a.window.width),1),r=Math.max(Math.floor(a.window.height),1),n=this._cameraConfigs.enableShadingScale?Math.max(Math.floor(o*this._cameraConfigs.shadingScale),1):o,d=this._cameraConfigs.enableShadingScale?Math.max(Math.floor(r*this._cameraConfigs.shadingScale),1):r,l=a.window.renderWindowId,h=this._cameraConfigs.colorName,c=this._cameraConfigs.enableShadingScale?"ScaledSceneDepth".concat(l):"SceneDepth".concat(l),p=this._cameraConfigs.enableShadingScale?"ScaledRadiance".concat(l):"Radiance".concat(l),g=this._cameraConfigs.enableShadingScale?"ScaledLdrColor".concat(l):"LdrColor".concat(l),m=t.mainLight;if(this.forwardLighting.cullLights(t,a.frustum),this._cameraConfigs.enableMainLightShadowMap&&(u(!!m),this._addCascadedShadowMapPass(e,l,m,a)),this._cameraConfigs.singleForwardRadiancePass&&this.forwardLighting.addSpotlightShadowPasses(e,a,this._configs.mobileMaxSpotLightShadowMaps),this._tryAddReflectionProbePasses(e,l,m,a.scene),this._cameraConfigs.enablePostProcess){if(this._cameraConfigs.enableDOF){u(!!s.depthOfField.material);var f="DofRadiance".concat(l);this._addForwardRadiancePasses(e,l,a,n,d,m,f,c,!0,A.STORE),this._addDepthOfFieldPasses(e,s,s.depthOfField.material,l,a,n,d,f,c,p,g)}else this._addForwardRadiancePasses(e,l,a,n,d,m,p,c);if(this._cameraConfigs.enableBloom&&(u(!!s.bloom.material),this._addKawaseDualFilterBloomPasses(e,s,s.bloom.material,l,n,d,p)),this._cameraConfigs.enableFXAA){u(!!s.fxaa.material);var _=this._cameraConfigs.enableHDR||this._cameraConfigs.enableColorGrading,S=_?g:p;if(_&&this._addCopyAndTonemapPass(e,s,n,d,p,S),this._cameraConfigs.enableShadingScale){var T="AaColor".concat(l);this._addFxaaPass(e,s.fxaa.material,n,d,S,T),i=this._cameraConfigs.enableFSR&&s.fsr.material?this._addFsrPass(e,s,s.fsr.material,l,n,d,T,o,r,h):this._addCopyPass(e,o,r,T,h)}else i=this._addFxaaPass(e,s.fxaa.material,o,r,S,h)}else i=this._addTonemapResizeOrSuperResolutionPasses(e,s,l,n,d,p,g,o,r,h)}else this._cameraConfigs.enableHDR||this._cameraConfigs.enableShadingScale?(this._addForwardRadiancePasses(e,l,a,n,d,m,p,c),i=this._addTonemapResizeOrSuperResolutionPasses(e,s,l,n,d,p,g,o,r,h)):i=this._addForwardRadiancePasses(e,l,a,o,r,m,h,this._cameraConfigs.depthStencilName);this._addUIQueue(a,i)}},{key:"_addTonemapResizeOrSuperResolutionPasses",value:function(e,a,t,i,s,o,r,n,d,l){var h;return this._cameraConfigs.enableFSR&&a.fsr.material?(this._addCopyAndTonemapPass(e,a,i,s,o,r),h=this._addFsrPass(e,a,a.fsr.material,t,i,s,r,n,d,l)):h=this._addCopyAndTonemapPass(e,a,n,d,o,l),h}},{key:"_addCascadedShadowMapPass",value:function(e,a,t,i){var s=e.pipelineSceneData.shadows.size.x,o=e.pipelineSceneData.shadows.size.y;this._viewport.left=0,this._viewport.top=0,this._viewport.width=s,this._viewport.height=o;var r=e.addRenderPass(s,o,"default");r.name="CascadedShadowMap",r.addRenderTarget("ShadowMap".concat(a),v.CLEAR,A.STORE,new E(1,1,1,1)),r.addDepthStencil("ShadowDepth".concat(a),v.CLEAR,A.DISCARD);for(var n=e.pipelineSceneData.csmSupported?t.csmLevel:1,d=0;d!==n;++d){z(t,s,o,d,this._viewport,this._configs.screenSpaceSignY);var l=r.addQueue(U.NONE,"shadow-caster");this._configs.isWebGPU||l.setViewport(this._viewport),l.addScene(i,W.OPAQUE|W.MASK|W.SHADOW_CASTER).useLightFrustum(t,d)}}},{key:"_addCopyPass",value:function(e,a,t,i,s){var o=e.addRenderPass(a,t,"cc-tone-mapping");return o.addRenderTarget(s,v.CLEAR,A.STORE,this._clearColorTransparentBlack),o.addTexture(i,"inputTexture"),o.setVec4("g_platform",this._configs.platform),o.addQueue(U.OPAQUE).addFullscreenQuad(this._copyAndTonemapMaterial,1),o}},{key:"_addCopyAndTonemapPass",value:function(e,a,t,i,s,o){var r;if(this._cameraConfigs.enableColorGrading&&a.colorGrading.material&&a.colorGrading.colorGradingMap){var n=a.colorGrading.colorGradingMap;this._colorGradingTexSize.x=n.width,this._colorGradingTexSize.y=n.height;var d=n.width===n.height;(r=d?e.addRenderPass(t,i,"cc-color-grading-8x8"):e.addRenderPass(t,i,"cc-color-grading-nx1")).addRenderTarget(o,v.CLEAR,A.STORE,this._clearColorTransparentBlack),r.addTexture(s,"sceneColorMap"),r.setVec4("g_platform",this._configs.platform),r.setVec2("lutTextureSize",this._colorGradingTexSize),r.setFloat("contribute",a.colorGrading.contribute),r.addQueue(U.OPAQUE).addFullscreenQuad(a.colorGrading.material,d?1:0)}else(r=e.addRenderPass(t,i,"cc-tone-mapping")).addRenderTarget(o,v.CLEAR,A.STORE,this._clearColorTransparentBlack),r.addTexture(s,"inputTexture"),r.setVec4("g_platform",this._configs.platform),a.toneMapping.material?r.addQueue(U.OPAQUE).addFullscreenQuad(a.toneMapping.material,0):r.addQueue(U.OPAQUE).addFullscreenQuad(this._copyAndTonemapMaterial,0);return r}},{key:"_buildForwardMainLightPass",value:function(e,a,t,i,s,o,r){var n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;e.setViewport(this._viewport);var d=this._cameraConfigs.enableMSAA?A.DISCARD:A.STORE;Q(t)?e.addRenderTarget(i,v.CLEAR,d,this._clearColor):e.addRenderTarget(i,v.LOAD,d),t.clearFlag&w.DEPTH_STENCIL?e.addDepthStencil(s,v.CLEAR,o,t.clearDepth,t.clearStencil,t.clearFlag&w.DEPTH_STENCIL):e.addDepthStencil(s,v.LOAD,o),this._cameraConfigs.enableMainLightShadowMap&&e.addTexture("ShadowMap".concat(a),"cc_shadowMap"),e.addQueue(U.NONE).addScene(t,W.OPAQUE|W.MASK,r||void 0,n||void 0)}},{key:"_addDepthOfFieldPasses",value:function(e,a,t,i,s,o,r,n,d,l,h){this._cocParams.x=a.depthOfField.focusDistance,this._cocParams.y=a.depthOfField.focusRange,this._cocParams.z=a.depthOfField.bokehRadius,this._cocParams.w=0,this._cocTexSize.x=1/o,this._cocTexSize.y=1/r,this._cocTexSize.z=o,this._cocTexSize.w=r;var c=Math.max(Math.floor(o/2),1),p=Math.max(Math.floor(r/2),1),g=h,u="DofPrefilter".concat(i),m="DofBokeh".concat(i),f="DofFilter".concat(i),_=e.addRenderPass(o,r,"cc-dof-coc");_.addRenderTarget(g,v.CLEAR,A.STORE,this._clearColorTransparentBlack),_.addTexture(d,"DepthTex"),_.setVec4("g_platform",this._configs.platform),_.setMat4("proj",s.matProj),_.setVec4("cocParams",this._cocParams),_.addQueue(U.OPAQUE).addCameraQuad(s,t,0);var S=e.addRenderPass(c,p,"cc-dof-prefilter");S.addRenderTarget(u,v.CLEAR,A.STORE,this._clearColorTransparentBlack),S.addTexture(n,"colorTex"),S.addTexture(g,"cocTex"),S.setVec4("g_platform",this._configs.platform),S.setVec4("mainTexTexelSize",this._cocTexSize),S.addQueue(U.OPAQUE).addFullscreenQuad(t,1);var T=e.addRenderPass(c,p,"cc-dof-bokeh");T.addRenderTarget(m,v.CLEAR,A.STORE,this._clearColorTransparentBlack),T.addTexture(u,"prefilterTex"),T.setVec4("g_platform",this._configs.platform),T.setVec4("mainTexTexelSize",this._cocTexSize),T.setVec4("cocParams",this._cocParams),T.addQueue(U.OPAQUE).addFullscreenQuad(t,2);var R=e.addRenderPass(c,p,"cc-dof-filter");R.addRenderTarget(f,v.CLEAR,A.STORE,this._clearColorTransparentBlack),R.addTexture(m,"bokehTex"),R.setVec4("g_platform",this._configs.platform),R.setVec4("mainTexTexelSize",this._cocTexSize),R.addQueue(U.OPAQUE).addFullscreenQuad(t,3);var b=e.addRenderPass(o,r,"cc-dof-combine");b.addRenderTarget(l,v.CLEAR,A.STORE,this._clearColorTransparentBlack),b.addTexture(n,"colorTex"),b.addTexture(g,"cocTex"),b.addTexture(f,"filterTex"),b.setVec4("g_platform",this._configs.platform),b.setVec4("cocParams",this._cocParams),b.addQueue(U.OPAQUE).addFullscreenQuad(t,4)}},{key:"_addKawaseDualFilterBloomPasses",value:function(e,a,t,i,s,o,r){var n=a.bloom.iterations,d=n+1;this._bloomWidths.length=d,this._bloomHeights.length=d,this._bloomWidths[0]=Math.max(Math.floor(s/2),1),this._bloomHeights[0]=Math.max(Math.floor(o/2),1);for(var l=1;l!==d;++l)this._bloomWidths[l]=Math.max(Math.floor(this._bloomWidths[l-1]/2),1),this._bloomHeights[l]=Math.max(Math.floor(this._bloomHeights[l-1]/2),1);this._bloomTexNames.length=d;for(var h=0;h!==d;++h)this._bloomTexNames[h]="BloomTex".concat(i,"_").concat(h);this._bloomParams.x=this._configs.useFloatOutput?1:0,this._bloomParams.x=0,this._bloomParams.z=a.bloom.threshold,this._bloomParams.w=a.bloom.enableAlphaMask?1:0;var c=e.addRenderPass(this._bloomWidths[0],this._bloomHeights[0],"cc-bloom-prefilter");c.addRenderTarget(this._bloomTexNames[0],v.CLEAR,A.STORE,this._clearColorTransparentBlack),c.addTexture(r,"inputTexture"),c.setVec4("g_platform",this._configs.platform),c.setVec4("bloomParams",this._bloomParams),c.addQueue(U.OPAQUE).addFullscreenQuad(t,0);for(var p=1;p!==d;++p){var g=e.addRenderPass(this._bloomWidths[p],this._bloomHeights[p],"cc-bloom-downsample");g.addRenderTarget(this._bloomTexNames[p],v.CLEAR,A.STORE,this._clearColorTransparentBlack),g.addTexture(this._bloomTexNames[p-1],"bloomTexture"),this._bloomTexSize.x=this._bloomWidths[p-1],this._bloomTexSize.y=this._bloomHeights[p-1],g.setVec4("g_platform",this._configs.platform),g.setVec4("bloomTexSize",this._bloomTexSize),g.addQueue(U.OPAQUE).addFullscreenQuad(t,1)}for(var u=n;u-- >0;){var m=e.addRenderPass(this._bloomWidths[u],this._bloomHeights[u],"cc-bloom-upsample");m.addRenderTarget(this._bloomTexNames[u],v.CLEAR,A.STORE,this._clearColorTransparentBlack),m.addTexture(this._bloomTexNames[u+1],"bloomTexture"),this._bloomTexSize.x=this._bloomWidths[u+1],this._bloomTexSize.y=this._bloomHeights[u+1],m.setVec4("g_platform",this._configs.platform),m.setVec4("bloomTexSize",this._bloomTexSize),m.addQueue(U.OPAQUE).addFullscreenQuad(t,2)}var f=e.addRenderPass(s,o,"cc-bloom-combine");f.addRenderTarget(r,v.LOAD,A.STORE),f.addTexture(this._bloomTexNames[0],"bloomTexture"),f.setVec4("g_platform",this._configs.platform),f.setVec4("bloomParams",this._bloomParams),f.addQueue(U.BLEND).addFullscreenQuad(t,3)}},{key:"_addFsrPass",value:function(e,a,t,i,s,o,r,n,d,l){this._fsrTexSize.x=s,this._fsrTexSize.y=o,this._fsrTexSize.z=n,this._fsrTexSize.w=d,this._fsrParams.x=m(1-a.fsr.sharpness,.02,.98);var h="FsrColor".concat(i),c=e.addRenderPass(n,d,"cc-fsr-easu");c.addRenderTarget(h,v.CLEAR,A.STORE,this._clearColorTransparentBlack),c.addTexture(r,"outputResultMap"),c.setVec4("g_platform",this._configs.platform),c.setVec4("fsrTexSize",this._fsrTexSize),c.addQueue(U.OPAQUE).addFullscreenQuad(t,0);var p=e.addRenderPass(n,d,"cc-fsr-rcas");return p.addRenderTarget(l,v.CLEAR,A.STORE,this._clearColorTransparentBlack),p.addTexture(h,"outputResultMap"),p.setVec4("g_platform",this._configs.platform),p.setVec4("fsrTexSize",this._fsrTexSize),p.setVec4("fsrParams",this._fsrParams),p.addQueue(U.OPAQUE).addFullscreenQuad(t,1),p}},{key:"_addFxaaPass",value:function(e,a,t,i,s,o){this._fxaaParams.x=t,this._fxaaParams.y=i,this._fxaaParams.z=1/t,this._fxaaParams.w=1/i;var r=e.addRenderPass(t,i,"cc-fxaa");return r.addRenderTarget(o,v.CLEAR,A.STORE,this._clearColorTransparentBlack),r.addTexture(s,"sceneColorMap"),r.setVec4("g_platform",this._configs.platform),r.setVec4("texSize",this._fxaaParams),r.addQueue(U.OPAQUE).addFullscreenQuad(a,0),r}},{key:"_addUIQueue",value:function(e,a){var t=W.UI;this._cameraConfigs.enableProfiler&&(t|=W.PROFILER,a.showStatistics=!0),a.addQueue(U.BLEND,"default","default").addScene(e,t)}},{key:"_addForwardRadiancePasses",value:function(e,a,t,i,s,o,r,n){var d=arguments.length>8&&void 0!==arguments[8]&&arguments[8],l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:A.DISCARD,h=t.clearColor;this._clearColor.x=h.x,this._clearColor.y=h.y,this._clearColor.z=h.z,this._clearColor.w=h.w;var c=t.viewport;this._viewport.left=Math.round(c.x*i),this._viewport.top=Math.round(c.y*s),this._viewport.width=Math.max(Math.round(c.width*i),1),this._viewport.height=Math.max(Math.round(c.height*s),1);var p=!d&&this._cameraConfigs.enableMSAA;u(!p||this._cameraConfigs.singleForwardRadiancePass);var g=this._cameraConfigs.singleForwardRadiancePass?this._addForwardSingleRadiancePass(e,a,t,p,i,s,o,r,n,l):this._addForwardMultipleRadiancePasses(e,a,t,i,s,o,r,n,l);this._cameraConfigs.enableMainLightPlanarShadowMap&&this.addPlanarShadowQueue(t,o,g);var m=W.BLEND|(t.geometryRenderer?W.GEOMETRY:W.NONE);return g.addQueue(U.BLEND).addScene(t,m,o||void 0),g}},{key:"_addForwardSingleRadiancePass",value:function(e,a,t,i,s,o,r,n,d,l){var h;if(u(this._cameraConfigs.singleForwardRadiancePass),i){var c="MsaaRadiance".concat(a),p="MsaaDepthStencil".concat(a),g=this._cameraConfigs.settings.msaa.sampleCount,m=e.addMultisampleRenderPass(s,o,g,0,"default");m.name="MsaaForwardPass",this._buildForwardMainLightPass(m,a,t,c,p,A.DISCARD,r),m.resolveRenderTarget(c,n),h=m}else(h=e.addRenderPass(s,o,"default")).name="ForwardPass",this._buildForwardMainLightPass(h,a,t,n,d,l,r);return u(void 0!==h),this.forwardLighting.addLightQueues(h,t,this._configs.mobileMaxSpotLightShadowMaps),h}},{key:"addPlanarShadowQueue",value:function(e,a,t){t.addQueue(U.BLEND,"planar-shadow").addScene(e,W.SHADOW_CASTER|W.PLANAR_SHADOW|W.BLEND,a||void 0)}},{key:"_addForwardMultipleRadiancePasses",value:function(e,a,t,i,s,o,r,n,d){u(!this._cameraConfigs.singleForwardRadiancePass);var l=e.addRenderPass(i,s,"default");l.name="ForwardPass";var h=this.forwardLighting.isMultipleLightPassesNeeded()?A.STORE:d;return this._buildForwardMainLightPass(l,a,t,r,n,h,o),l=this.forwardLighting.addLightPasses(r,n,d,a,i,s,t,this._viewport,e,l)}},{key:"_buildReflectionProbePass",value:function(e,a,t,i,s,o){var r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,n=this._cameraConfigs.enableMSAA?A.DISCARD:A.STORE;if(Q(t)){this._reflectionProbeClearColor.x=t.clearColor.x,this._reflectionProbeClearColor.y=t.clearColor.y,this._reflectionProbeClearColor.z=t.clearColor.z;var l=d.packRGBE(this._reflectionProbeClearColor);this._clearColor.x=l.x,this._clearColor.y=l.y,this._clearColor.z=l.z,this._clearColor.w=l.w,e.addRenderTarget(i,v.CLEAR,n,this._clearColor)}else e.addRenderTarget(i,v.LOAD,n);t.clearFlag&w.DEPTH_STENCIL?e.addDepthStencil(s,v.CLEAR,A.DISCARD,t.clearDepth,t.clearStencil,t.clearFlag&w.DEPTH_STENCIL):e.addDepthStencil(s,v.LOAD,A.DISCARD),this._cameraConfigs.enableMainLightShadowMap&&e.addTexture("ShadowMap".concat(a),"cc_shadowMap"),e.addQueue(U.NONE,"reflect-map").addScene(t,W.OPAQUE|W.MASK|W.REFLECTION_PROBE,o||void 0,r||void 0)}},{key:"_tryAddReflectionProbePasses",value:function(e,a,t,o){var d=s.internal.reflectionProbeManager;if(d){var l,h=d.getProbes(),c=0,p=i(h);try{for(p.s();!(l=p.n()).done;){var g=l.value;if(g.needRender){var u=g.renderArea(),m=Math.max(Math.floor(u.x),1),f=Math.max(Math.floor(u.y),1);if(g.probeType===n.scene.ProbeType.PLANAR){if(!this._cameraConfigs.enablePlanarReflectionProbe)continue;var _=g.realtimePlanarTexture.window,S="PlanarProbeRT".concat(c),T="PlanarProbeDS".concat(c);e.addRenderWindow(S,this._cameraConfigs.radianceFormat,m,f,_),e.addDepthStencil(T,r.Format.DEPTH_STENCIL,m,f,X.MEMORYLESS);var R=e.addRenderPass(m,f,"default");R.name="PlanarReflectionProbe".concat(c),this._buildReflectionProbePass(R,a,g.camera,S,T,t,o)}else;if(4===++c)break}}}catch(e){p.e(e)}finally{p.f()}}}},{key:"_initMaterials",value:function(e){return this._initialized?0:(k(e,this._configs),this._copyAndTonemapMaterial._uuid="builtin-pipeline-tone-mapping-material",this._copyAndTonemapMaterial.initialize({effectName:"pipeline/post-process/tone-mapping"}),this._copyAndTonemapMaterial.effectAsset&&(this._initialized=!0),this._initialized?0:1)}}]),o}();d.setCustomPipeline("Builtin",new j)}s._RF.pop()}}}));

System.register("bundle://internal/_virtual/env",[],(function(e){return{execute:function(){e("EDITOR",!1),e("DEBUG",!1)}}}));

System.register("bundle://internal/_virtual/internal",["./builtin-pipeline-settings.ts","./builtin-pipeline-types.ts","./builtin-pipeline.ts"],(function(){return{setters:[null,null,null],execute:function(){}}}));

System.register("bundle://internal/_virtual/rollupPluginModLoBabelHelpers.js",[],(function(e){return{execute:function(){function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function r(t){return(r=e("getPrototypeOf",Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)}))(t)}function n(t,r){return(n=e("setPrototypeOf",Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e}))(t,r)}function o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return i(e)}function a(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function f(e){var t=l(e,"string");return"symbol"==typeof t?t:String(t)}e({applyDecoratedDescriptor:function(e,t,r,n,o){var i={};Object.keys(n).forEach((function(e){i[e]=n[e]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0);i=r.slice().reverse().reduce((function(r,n){return n(e,t,r)||r}),i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0);void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null);return i},arrayLikeToArray:c,assertThisInitialized:i,classCallCheck:function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass:function(e,r,n){r&&t(e.prototype,r);n&&t(e,n);return Object.defineProperty(e,"prototype",{writable:!1}),e},createForOfIteratorHelper:function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=a(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return u=e.done,e},e:function(e){c=!0,i=e},f:function(){try{u||null==r.return||r.return()}finally{if(c)throw i}}}},createSuper:function(e){var t=o();return function(){var n,o=r(e);if(t){var i=r(this).constructor;n=Reflect.construct(o,arguments,i)}else n=o.apply(this,arguments);return u(this,n)}},defineProperty:function(e,t,r){(t=f(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e},getPrototypeOf:r,inherits:function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&n(e,t)},initializerDefineProperty:function(e,t,r,n){if(!r)return;Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})},isNativeReflectConstruct:o,possibleConstructorReturn:u,setPrototypeOf:n,toPrimitive:l,toPropertyKey:f,unsupportedIterableToArray:a})}}}));

(function(r) {
  r('virtual:///prerequisite-imports/internal', 'bundle://internal/_virtual/internal'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});